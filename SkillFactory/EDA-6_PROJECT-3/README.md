## Проект 3: Модель предсказания рейтинга отеля

#### Постановка задачи
Необходимо обучить модель, которая должна предсказывать рейтинг отеля по данным сайта Booking на основе имеющихся в датасете данных. Исходные данные - датасет, в котором содержатся сведения о 515 000 отзывов на отели Европы.

#### Структура датасета
Датасет содержит 17 полей со следующей информацией:
- *hotel_address* — адрес отеля;
- *additional_number_of_scoring* — есть некоторые гости, которые просто поставили оценку сервису, но не оставили отзыв. Это число указывает, сколько там действительных оценок без проверки;
- *review_date* — дата, когда рецензент разместил соответствующий отзыв;
- *average_score* — средний балл отеля, рассчитанный на основе последнего комментария за последний год;
- *hotel_name* — название отеля;
- revi*ewer_nationality — страна рецензента;
- neg*ative_review — отрицательный отзыв, который рецензент дал отелю;
- *review_total_negative_word_counts* — общее количество слов в отрицательном отзыв;
- *positive_review* — положительный отзыв, который рецензент дал отелю;
- *review_total_positive_word_counts* — общее количество слов в положительном отзыве.
- *reviewer_score* — оценка, которую рецензент поставил отелю на основе своего опыта;
- *total_number_of_reviews_reviewer_has_given* — количество отзывов, которые рецензенты дали в прошлом;
- *total_number_of_reviews* — общее количество действительных отзывов об отеле;
- t*ags — теги, которые рецензент дал отелю;
- *days_since_review* — количество дней между датой проверки и датой очистки;
- *lat* — географическая широта отеля;
- *lng* — географическая долгота отеля.

#### Знакомство с данными

Первым делом объединено 2 датафрема с тестовыми и тренировочными данными в один. 
На данном этапе провели первичное знакомство с данными. Посмотрены статистические показатели по числовым и категориальным признакам.   

Выявлено, что ни один признак в данных не распределен нормально, кроме  кроме признака average_score. 

На основе построенной матрицы корреляции наблюдается слабая связь между целеым признаком reviewer_score и зависимыми показателями. 
При этом существует сильная связь между 2 признаками: total_number_of_reviews и additional_number_of_scoring, что говорит о мультиколлинеарности. На этапе Отбора признаков один из них удалим из данных.

#### Очистка данных

По результатам проверки в данных наблюдаются пропуски в полях координат отеля, а также наличие дубликатов.  
При этом дубликаты (366 шт) не удалялись в виду того, что размер датафрейма submission составляет (128935, 2), то есть равный исходным данным в тестовой выборке.   

Что касается пропусков, то было принято решение воспользоваться библиотекой geopy для поиска координат по названиям отелей. Получили отличный результат, из 17 позиций нашли координаты по 11 отелям. По оставшимся пришлось найти координаты вручную в сети интернет.

#### Генерация признаков 

Самый творческий блок.

Из всех данных датафрейма 4 поля представляют интерес для генерации признаков:
- количество дней, прошедших с даты отзыва. Данное поле записано в строком формате "число дней и days", заберем количество дней в числовом формате. Возможно данный признак будет оказывать влияние на рейтинг отеля.
- поля тэгов, это строковые данные, которые содержат в себе доп информацию о типе поездки, количестве дней остановки, количестве отдыхающих, типе номера и с какого устрайства забронирован номер (мобильный телефон или нет);
- дата выставления оценки, забрем из даты год, квартал (сезон), месяц;
- адрес отеля, из адреса можно получить информацию о стране расположения отеля для дальнейшего сравнения с национальностью рецензента. Город здесь является неинформартивым признаком, так как он будет в мультиколлинеарной зависимости со страной.

Для вновь добавленных признаков были составлены статистические тесты и визуализации, сформированы гипотезы и проверены.

По результатам генерации сформированы следующие признаки:   
- *stayed_night* - количество дней остановки;
- *purpose_trip_Business trip* - флаг тип отдыха "Бизнес-поездка"
- *purpose_trip_Leisure trip* - флаг тип отдыха "Отпуск";
- *submitted_mobile* - флаг бронирование по мобильному телефону;
- *is_first_q* - флаг присвоения месяца написания отзыва к 1 кварталу;
- *year* - год написания отзыва;
- *month* - месяц написания отзыва;
- *is_loc_match* - флаг совпадения страны расположения отеля и национальности рецензента;
- *country_hotel_Austria* - флаг распложения отеля в Австрии;
- *country_hotel_France*- флаг распложения отеля во Франции;
- *country_hotel_Italy* - флаг распложения отеля в Италии;
- *country_hotel_Netherlands* - флаг распложения отеля в Голландии;
- *country_hotel_Spain* - флаг распложения отеля в Испании;
- *country_hotel_United Kingdom* - флаг распложения отеля в СК;
- *in_chain* - флаг сетевой принадлежности отеля;
- *negative_review_really* - флаг после очистки негативных отзывов от мусора;
- *positive_review_really* - флаг после очистки положительных отзывов от мусора.

#### Преобразование признаков

Преобразование признаков было выполнено в 2 вариантах: 
- нормализация методом MinMaxScaler;
- стандартизация методом StandardScaler.
По итогам исследования нормализация признаков показала лучший результат модели по метрике MAPE.

#### Обучение модели и оценка результатов по MAPE

Обучена модель регрессии методом RandomForestRegressor для предсказания тестовых результатов.
В результате исследования метрика MAPE на тестовых данных псоставила 0.1378, что лучше базового результата решения без преобрабоки данных.

#### Используемые библиотеки
- *pandas* - для работы с данными;
- *numpy* - для проверки данных;
- *seaborn* - для визуализации;
- *matplotlib.pyplot* - для визуализации;
- *sklearn.preprocessing* - для стандартизации и нормализации;
- *sklearn.feature_selection, chi2* - хи-квадрат;
- *sklearn.feature_selection import, f_classif* - anova; 
- *re* - для регулярных выражений;
- *sklearn.model_selection, train_test_split* - для разбивки выборок на тренировочную и тестовую;
- *sklearn.ensemble, RandomForestRegressor* - инструмент для создания и обучения модели;  
- *sklearn.metrics* - инструменты для оценки точности модели;
- *scipy.stats* - для стат проверки зависимостей chi2.

:arrow_up:[к Оглавлению](https://github.com/vadimkopytko/learning/tree/main/SkillFactory/EDA-6_PROJECT-3/README.md#Оглавление)